<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BATTLE ARENA | 50,000 UAH</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #f39c12; --bg: #000; --card: #1c1c1e; --radius: 25px; --drop-shadow: 0 10px 30px rgba(243, 156, 18, 0.15); }
        
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; padding-top: 85px; -webkit-font-smoothing: antialiased; }
        
        /* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */
        .nav { position: fixed; top: 0; left: 0; right: 0; background: rgba(15, 15, 15, 0.9); backdrop-filter: blur(25px); display: flex; overflow-x: auto; padding: 12px 5px; border-bottom: 0.5px solid #333; z-index: 9999; scrollbar-width: none; }
        .nav::-webkit-scrollbar { display: none; }
        .nav-item { color: #888; text-decoration: none; font-size: 10px; font-weight: 700; text-align: center; white-space: nowrap; padding: 10px 15px; border-radius: 18px; transition: 0.3s; cursor: pointer; flex-shrink: 0; }
        .nav-item.active { color: var(--accent); background: rgba(255,255,255,0.08); box-shadow: var(--drop-shadow); }

        h2 { font-size: 28px; font-weight: 900; margin-bottom: 15px; letter-spacing: -1px; background: linear-gradient(to right, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: smoothShow 0.4s ease-out; }
        @keyframes smoothShow { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        
        /* –ö–ê–†–¢–ö–ò "–ö–ê–ü–ï–õ–¨–ö–ê" */
        .card { background: var(--card); border-radius: var(--radius); padding: 25px; margin-bottom: 20px; border: 0.5px solid #333; box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        .card::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(243,156,18,0.05) 0%, transparent 70%); pointer-events: none; }
        
        .prize-badge { background: var(--accent); color: #000; padding: 5px 15px; border-radius: 50px; font-weight: 800; font-size: 14px; display: inline-block; margin-bottom: 15px; }

        /* –°–£–î–î–Ü */
        .judge-card { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .judge-img { width: 70px; height: 70px; border-radius: 50%; background: #333; object-fit: cover; border: 2px solid var(--accent); }
        .social-link { color: var(--accent); text-decoration: none; font-size: 12px; font-weight: 600; }

        /* –ü–õ–ï–Ñ–† */
        audio { width: 100%; height: 45px; margin: 15px 0; border-radius: 15px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }
        
        /* –§–û–†–ú–ò */
        input { background: #2c2c2e; border: 1px solid #3d3d3f; color: #fff; padding: 18px; border-radius: 20px; width: 100%; box-sizing: border-box; margin-bottom: 15px; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(243,156,18,0.2); outline: none; }
        
        button { background: var(--accent); color: #000; border: none; padding: 20px; border-radius: 25px; width: 100%; font-weight: 900; font-size: 16px; cursor: pointer; transition: 0.3s; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
        button:active { transform: scale(0.95); }

        .rules-text { font-size: 13px; color: #aaa; line-height: 1.6; max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

    <nav class="nav">
        <div class="nav-item active" onclick="showTab('tab-home', this)">üè† –ì–û–õ–û–í–ù–ê</div>
        <div class="nav-item" onclick="showTab('tab-judges', this)">üë®‚Äç‚öñÔ∏è –°–£–î–î–Ü</div>
        <div class="nav-item" onclick="showTab('tab-results', this)">üèÜ –†–ï–ô–¢–ò–ù–ì</div>
        <div class="nav-item" onclick="showTab('tab-reg', this)">üé§ –£–ß–ê–°–¢–¨</div>
        <div class="nav-item" onclick="showTab('tab-admin', this)">üõ°Ô∏è –ê–î–ú–Ü–ù</div>
    </nav>

    <div id="tab-home" class="tab-content active">
        <div class="card">
            <div class="prize-badge">–ü–†–ò–ó–û–í–ò–ô –§–û–ù–î: 50 000 –ì–†–ù</div>
            <h2>BATTLE ARENA 2024</h2>
            <p style="color: #ccc; line-height: 1.6;">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –Ω–∞ –Ω–∞–π–º–∞—Å—à—Ç–∞–±–Ω—ñ—à–∏–π –æ–Ω–ª–∞–π–Ω-–±–∞—Ç—Ç–ª —Ä–æ–∫—É! –ü–æ–∫–∞–∂–∏ —Å–≤—ñ–π —Ñ–ª–æ—É, —Ç–µ—Ö–Ω—ñ–∫—É —Ç–∞ –ø–∞–Ω—á—ñ. –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å –æ—Ç—Ä–∏–º–∞—î –≥–æ–ª–æ–≤–Ω–∏–π –ø—Ä–∏–∑ —Ç–∞ –≤–∏–∑–Ω–∞–Ω–Ω—è —Ç–æ–ø–æ–≤–∏—Ö —Å—É–¥–¥—ñ–≤.</p>
            <p style="color: var(--accent); font-weight: 700;">–ü–µ—Ä—à–µ –º—ñ—Å—Ü–µ ‚Äî 50 000 –≥—Ä–Ω üí∞</p>
            <button onclick="showTab('tab-reg')">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –≥—Ä–∏</button>
        </div>
    </div>

    <div id="tab-judges" class="tab-content">
        <h2>–°—É–¥–¥—ñ–≤—Å—å–∫–∞ –∫–æ–ª–µ–≥—ñ—è</h2>
        <div class="card">
            <div class="judge-card">
                <div class="judge-img"></div>
                <div>
                    <div class="name">Judge One</div>
                    <div style="font-size: 12px; color: #888;">–ü—Ä–æ—Ñ—ñ —É —Å—Ñ–µ—Ä—ñ —Ñ–ª–æ—É —Ç–∞ —Ä–∏—Ç–º—ñ–∫–∏.</div>
                    <a href="#" class="social-link">Instagram ‚Üí</a>
                </div>
            </div>
            <div class="judge-card">
                <div class="judge-img"></div>
                <div>
                    <div class="name">Judge Two</div>
                    <div style="font-size: 12px; color: #888;">–ú–∞–π—Å—Ç–µ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ—ó —Å–∫–ª–∞–¥–æ–≤–æ—ó.</div>
                    <a href="#" class="social-link">Instagram ‚Üí</a>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-results" class="tab-content">
        <h2>–¢—É—Ä–Ω—ñ—Ä–Ω–∞ —Ç–∞–±–ª–∏—Ü—è</h2>
        <div id="results-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>

    <div id="tab-reg" class="tab-content">
        <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ –≤—ñ–¥–±—ñ—Ä–∫–æ–≤–∏–π</h2>
        <form id="reg-form">
            <input type="text" id="reg-name" placeholder="–¢–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º" required>
            <input type="text" id="reg-city" placeholder="–¢–≤–æ—î –º—ñ—Å—Ç–æ" required>
            <label style="font-size: 12px; color: #888; margin-left: 10px;">–ó–∞–≤–∞–Ω—Ç–∞–∂ –≤—ñ–¥–±—ñ—Ä–∫–æ–≤–∏–π —Ç—Ä–µ–∫:</label>
            <input type="file" id="reg-file" accept="audio/*" required style="border:none; background:transparent;">
            
            <div id="rules-box" class="rules-text">
                1. –¢—Ä–µ–∫ –º–∞—î –±—É—Ç–∏ –¥–æ 2-—Ö —Ö–≤–∏–ª–∏–Ω.<br>
                2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –®–Ü –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ.<br>
                3. –¢–µ–∫—Å—Ç –º–∞—î –±—É—Ç–∏ –∞–≤—Ç–æ—Ä—Å—å–∫–∏–º.<br>
                4. –°—É–¥–¥—ñ –æ—Ü—ñ–Ω—é—é—Ç—å –∑–∞ 10-–±–∞–ª—å–Ω–æ—é —à–∫–∞–ª–æ—é.
            </div>

            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <input type="checkbox" id="reg-rules" required style="width: 25px; height: 25px; margin: 0;">
                <span style="font-size: 13px;">–ó–≥–æ–¥–µ–Ω –∑ <a href="javascript:void(0)" onclick="document.getElementById('rules-box').style.display='block'" style="color:var(--accent)">–ø—Ä–∞–≤–∏–ª–∞–º–∏</a></span>
            </div>
            
            <button type="submit" id="btn-submit">–í–Ü–î–ü–†–ê–í–ò–¢–ò –ù–ê –í–Ü–î–ë–Ü–†</button>
        </form>
    </div>

    <div id="tab-admin" class="tab-content">
        <div id="login-form">
            <h2>–í—Ö—ñ–¥ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <input type="text" id="log-user" placeholder="–õ–æ–≥—ñ–Ω">
            <input type="password" id="log-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="tryLogin()">–£–í–Ü–ô–¢–ò</button>
        </div>
        <div id="admin-panel" style="display:none;">
            <h2 id="judge-display-name">–ü–∞–Ω–µ–ª—å —Å—É–¥–¥—ñ</h2>
            <div id="admin-list"></div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzO2qKA5Tk5946g1EiImQueRoxNYBprZpM6kY5VIFRG8dZyai3i56A_lTXzV-dGt8T9/exec";
        let currentUser = null;

        function showTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if(el) el.classList.add('active');
            if(tabId === 'tab-results' || (tabId === 'tab-admin' && currentUser)) loadData();
        }

        function formatDriveUrl(url) {
            if(!url) return "";
            let id = (url.includes('id=')) ? url.split('id=')[1].split('&')[0] : (url.includes('file/d/')) ? url.split('file/d/')[1].split('/')[0] : url;
            return id.length > 20 ? `https://docs.google.com/uc?export=download&id=${id}` : url;
        }

        async function loadData() {
            try {
                const res = await fetch(API_URL + "?action=getData");
                const data = await res.json();
                
                const acceptedUsers = data.users.filter(u => u[5] === "–ü—Ä–∏–π–Ω—è—Ç–æ");
                document.getElementById('results-list').innerHTML = acceptedUsers.length > 0 ? 
                acceptedUsers.map(u => `
                    <div class="card">
                        <div class="name">${u[1]}</div>
                        <div style="color:var(--accent); font-size:12px; margin-bottom:10px;">üìç ${u[2]}</div>
                        <audio controls src="${formatDriveUrl(u[3])}"></audio>
                    </div>
                `).join('') : "<p style='text-align:center; opacity:0.5;'>–í—ñ–¥–±—ñ—Ä —Ç—Ä–∏–≤–∞—î...</p>";

                if(currentUser) {
                    const allUsers = data.users.slice(1);
                    document.getElementById('admin-list').innerHTML = allUsers.map(u => `
                        <div class="card">
                            <div class="name">${u[1]} <span style="font-size:10px; color:var(--accent)">[${u[5]}]</span></div>
                            <audio controls src="${formatDriveUrl(u[3])}"></audio>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                                <input type="number" placeholder="–ë–∞–ª">
                                <button style="padding:10px; font-size:10px; margin:0;">–û–¶–Ü–ù–ò–¢–ò</button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (e) { console.error(e); }
        }

        async function tryLogin() {
            const u = document.getElementById('log-user').value;
            const p = document.getElementById('log-pass').value;
            const res = await fetch(API_URL + "?action=getData");
            const data = await res.json();
            const judge = data.judges.find(j => j[0] == u && j[1] == p);
            if(judge) {
                currentUser = judge[2];
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('judge-display-name').innerText = "–°—É–¥–¥—è: " + currentUser;
                loadData();
            } else { alert("–ü–æ–º–∏–ª–∫–∞!"); }
        }

        document.getElementById('reg-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.innerText = "–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø..."; btn.disabled = true;
            const file = document.getElementById('reg-file').files[0];
            const reader = new FileReader();
            reader.onload = async () => {
                const payload = {
                    name: document.getElementById('reg-name').value,
                    city: document.getElementById('reg-city').value,
                    fileData: reader.result.split(',')[1],
                    fileName: file.name,
                    mimeType: file.type
                };
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                alert("–¢—Ä–µ–∫ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –≤—ñ–¥–±—ñ—Ä!");
                document.getElementById('reg-form').reset();
                btn.innerText = "–í–Ü–î–ü–†–ê–í–ò–¢–ò –ù–ê –í–Ü–î–ë–Ü–†"; btn.disabled = false;
            };
            reader.readAsDataURL(file);
        };
    </script>
</body>
</html>
