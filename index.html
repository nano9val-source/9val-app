<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9VAL BATTLE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #0a0a0a; color: #fff; margin: 0; padding-bottom: 80px; }
        .card { background: #151515; border-radius: 12px; padding: 15px; margin: 15px; border-left: 4px solid #f39c12; }
        .btn { width: 100%; padding: 15px; background: #f39c12; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        input { width: 90%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #111; display: flex; padding: 10px 0; border-top: 1px solid #333; }
        .nav-item { flex: 1; text-align: center; color: #888; font-size: 12px; }
        .nav-item.active { color: #f39c12; }
        .judge-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #222; }
        .soc-btn { color: #f39c12; text-decoration: none; border: 1px solid #f39c12; padding: 3px 7px; border-radius: 4px; font-size: 11px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="tab-home">
        <div style="padding: 20px; text-align: center; background: #111;">
            <h1 style="color:#f39c12; margin:0;">9VAL BATTLE</h1>
            <p style="font-size:12px; color:#666;">SEASON 1 | QUALIFICATION</p>
        </div>
        <div class="card">
            <h3>–°–£–î–î–Ü–í–°–¨–ö–ò–ô –°–ö–õ–ê–î</h3>
            <div id="judges-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—É–¥–¥—ñ–≤...</div>
        </div>
        <div class="card">
            <h3>–ü–†–ê–í–ò–õ–ê</h3>
            <p style="font-size: 13px; color:#ccc;">1. –¢—Ä–µ–∫ –¥–æ 13 –ú–ë.<br>2. –§–æ—Ä–º–∞—Ç MP3/WAV.<br>3. –¢—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä—Å—å–∫–∏–π —Ç–µ–∫—Å—Ç.</p>
            <button class="btn" onclick="showTab('reg')">–ü–û–î–ê–¢–ò –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>

    <div id="tab-reg" class="hidden">
        <div class="card">
            <h2>–†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø</h2>
            <input type="text" id="name" placeholder="–¢–≤—ñ–π –ù—ñ–∫–Ω–µ–π–º">
            <input type="text" id="city" placeholder="–¢–≤–æ—î –ú—ñ—Å—Ç–æ">
            <input type="file" id="trackFile">
            <button class="btn" id="sendBtn" onclick="upload()">–í–Ü–î–ü–†–ê–í–ò–¢–ò</button>
        </div>
    </div>

    <div id="tab-list" class="hidden">
        <div class="card">
            <h2>–£–ß–ê–°–ù–ò–ö–ò</h2>
            <div id="users-list">–¢—É—Ç –±—É–¥—É—Ç—å —Ç—ñ–ª—å–∫–∏ —Å—Ö–≤–∞–ª–µ–Ω—ñ –∞—Ä—Ç–∏—Å—Ç–∏.</div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="n-home" onclick="showTab('home')">üè† –ì–æ–ª–æ–≤–Ω–∞</div>
        <div class="nav-item" id="n-reg" onclick="showTab('reg')">üé§ –£—á–∞—Å—Ç—å</div>
        <div class="nav-item" id="n-list" onclick="showTab('list')">üèÜ –ì—Ä–∞–≤—Ü—ñ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        // –í–°–¢–ê–í –°–í–û–Ñ –ü–û–°–ò–õ–ê–ù–ù–Ø /EXEC –ù–ò–ñ–ß–ï
        const URL = "–¢–£–¢_–¢–í–û–Ñ_–ù–û–í–ï_–ü–û–°–ò–õ–ê–ù–ù–Ø_EXEC";

        function showTab(t) {
            ['home', 'reg', 'list'].forEach(s => document.getElementById('tab-'+s).classList.add('hidden'));
            ['home', 'reg', 'list'].forEach(n => document.getElementById('n-'+n).classList.remove('active'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.getElementById('n-'+t).classList.add('active');
            if(t === 'home' || t === 'list') loadData();
        }

        async function loadData() {
            const res = await fetch(URL + "?action=getData");
            const data = await res.json();
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –°—É–¥–¥—ñ–≤
            const jList = document.getElementById('judges-list');
            jList.innerHTML = "";
            data.judges.forEach(j => {
                jList.innerHTML += `<div class="judge-row"><span>${j[2]}</span><a href="${j[3]}" class="soc-btn">–°–û–¶–ú–ï–†–ï–ñ–Ü</a></div>`;
            });

            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –£—á–∞—Å–Ω–∏–∫—ñ–≤
            const uList = document.getElementById('users-list');
            uList.innerHTML = "";
            data.users.slice(1).forEach(u => {
                uList.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222;"><b>${u[1]}</b><br><a href="${u[3]}" target="_blank" style="color:#f39c12; font-size:12px;">üéß –°–ª—É—Ö–∞—Ç–∏</a></div>`;
            });
        }

        async function upload() {
            const name = document.getElementById('name').value;
            const file = document.getElementById('trackFile').files[0];
            if(!name || !file) return alert("–ó–∞–ø–æ–≤–Ω–∏ –≤—Å–µ!");
            if(file.size > 13*1024*1024) return alert("–ú–∞–∫—Å 13 –ú–ë!");

            const btn = document.getElementById('sendBtn');
            btn.innerText = "–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø...";
            btn.disabled = true;

            const reader = new FileReader();
            reader.onload = async function() {
                const payload = {
                    action: 'register',
                    id: tg.initDataUnsafe?.user?.id || "USER",
                    name: name,
                    city: document.getElementById('city').value,
                    fileName: file.name,
                    fileData: reader.result
                };
                await fetch(URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                alert("–£—Å–ø—ñ—à–Ω–æ! –ß–µ–∫–∞–π –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –±–æ—Ç.");
                showTab('home');
            };
            reader.readAsDataURL(file);
        }
        
        loadData(); // –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    </script>
</body>
</html>
