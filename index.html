<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Battle Arena iOS Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #f39c12; --bg: #000; --card: #1c1c1e; --radius: 20px; }
        
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; padding-top: 80px; -webkit-font-smoothing: antialiased; }
        
        /* –í–ï–†–•–ù–Ø –ù–ê–í–Ü–ì–ê–¶–Ü–Ø –í –°–¢–ò–õ–Ü iOS */
        .nav { position: fixed; top: 0; left: 0; right: 0; background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(15px); display: flex; justify-content: space-around; padding: 10px 5px; border-bottom: 0.5px solid #333; z-index: 1000; }
        .nav-item { color: #888; text-decoration: none; font-size: 11px; font-weight: 600; text-align: center; flex: 1; padding: 8px 0; border-radius: 12px; transition: 0.3s; }
        .nav-item.active { color: var(--accent); background: rgba(255,255,255,0.05); }

        h2 { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: #fff; }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* –ö–ê–†–¢–ö–ò (iOS Style) */
        .card { background: var(--card); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 0.5px solid #333; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .name { font-size: 19px; font-weight: 600; margin-bottom: 5px; }
        
        /* –ê–£–î–Ü–û –ü–õ–ï–Ñ–† */
        audio { width: 100%; height: 36px; margin: 15px 0; border-radius: 10px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }
        
        /* –§–û–†–ú–ò –¢–ê –Ü–ù–ü–£–¢–ò (–ö—Ä—É–≥–ª—ñ) */
        input { background: #2c2c2e; border: none; color: #fff; padding: 14px 18px; border-radius: 15px; width: 100%; box-sizing: border-box; margin-bottom: 15px; font-size: 16px; }
        input:focus { outline: 2px solid var(--accent); }
        
        button { background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 25px; width: 100%; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.97); opacity: 0.9; }
        button:disabled { background: #555; }

        /* –ì–ê–õ–û–ß–ö–ê (Checkbox) */
        .rules-box { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; font-size: 14px; color: #aaa; }
        .rules-box input[type="checkbox"] { width: 22px; height: 22px; margin: 0; cursor: pointer; accent-color: var(--accent); }

        /* –ê–¥–º—ñ–Ω–∫–∞ */
        .judge-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .judge-grid label { font-size: 11px; color: #888; font-weight: 600; margin-left: 5px; }
    </style>
</head>
<body>

    <nav class="nav">
        <a href="javascript:void(0)" class="nav-item active" onclick="showTab('tab-results', this)">üèÜ –†–ï–ô–¢–ò–ù–ì</a>
        <a href="javascript:void(0)" class="nav-item" onclick="showTab('tab-reg', this)">üé§ –£–ß–ê–°–¢–¨</a>
        <a href="javascript:void(0)" class="nav-item" onclick="showTab('tab-admin', this)">üõ°Ô∏è –ê–î–ú–Ü–ù</a>
    </nav>

    <div id="tab-results" class="tab-content active">
        <h2>–¢—É—Ä–Ω—ñ—Ä–Ω–∞ —Ç–∞–±–ª–∏—Ü—è</h2>
        <div id="results-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>

    <div id="tab-reg" class="tab-content">
        <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ –±–∞—Ç—Ç–ª</h2>
        <form id="reg-form">
            <input type="text" id="reg-name" placeholder="–¢–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º" required>
            <input type="text" id="reg-city" placeholder="–¢–≤–æ—î –º—ñ—Å—Ç–æ" required>
            <p style="font-size: 13px; color: #888; margin-bottom: 10px;">–í–∏–±–µ—Ä–∏ –∞—É–¥—ñ–æ-—Ñ–∞–π–ª —Ç—Ä–µ–∫—É:</p>
            <input type="file" id="reg-file" accept="audio/*" required style="padding: 10px; background: transparent;">
            
            <div class="rules-box">
                <input type="checkbox" id="reg-rules" required>
                <span>–Ø –∑–≥–æ–¥–µ–Ω –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±–∞—Ç—Ç–ª—É —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è–º —Å—É–¥–¥—ñ–≤</span>
            </div>
            
            <button type="submit" id="btn-submit">–í–Ü–î–ü–†–ê–í–ò–¢–ò –¢–†–ï–ö</button>
        </form>
    </div>

    <div id="tab-admin" class="tab-content">
        <div id="login-form">
            <h2>–í—Ö—ñ–¥ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <input type="text" id="log-user" placeholder="–õ–æ–≥—ñ–Ω">
            <input type="password" id="log-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="tryLogin()">–£–í–Ü–ô–¢–ò</button>
        </div>
        <div id="admin-panel" style="display:none;">
            <h2 id="judge-name">–°—É–¥–¥—è</h2>
            <div id="admin-list"></div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzO2qKA5Tk5946g1EiImQueRoxNYBprZpM6kY5VIFRG8dZyai3i56A_lTXzV-dGt8T9/exec";
        let currentUser = null;

        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'tab-results') loadData();
        }

        function formatDriveUrl(url) {
            if(!url) return "";
            let id = "";
            if(url.includes('id=')) id = url.split('id=')[1].split('&')[0];
            else if(url.includes('file/d/')) id = url.split('file/d/')[1].split('/')[0];
            return id ? `https://docs.google.com/uc?export=download&id=${id}` : url;
        }

        async function loadData() {
            try {
                const res = await fetch(API_URL + "?action=getData");
                const data = await res.json();
                
                const acceptedUsers = data.users.filter(u => u[5] === "
