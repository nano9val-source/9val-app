<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>9VAl-BATTL | OFFICIAL APP</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #f39c12; --bg: #000; --card: #1c1c1e; --radius: 18px; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; padding-top: 85px; }
        .nav { position: fixed; top: 0; left: 0; right: 0; background: rgba(10,10,10,0.95); backdrop-filter: blur(15px); display: flex; overflow-x: auto; padding: 10px 5px; border-bottom: 0.5px solid #333; z-index: 9999; scrollbar-width: none; }
        .nav-item { color: #777; font-size: 10px; font-weight: 800; text-align: center; white-space: nowrap; padding: 12px 15px; border-radius: 12px; transition: 0.3s; cursor: pointer; flex-shrink: 0; }
        .nav-item.active { color: var(--accent); background: rgba(243,156,18,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: var(--card); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 0.5px solid #333; }
        .prize-badge { background: var(--accent); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: 900; display: inline-block; margin-bottom: 10px; }
        .rules-list { font-size: 13px; color: #aaa; padding-left: 20px; line-height: 1.6; }
        .match { background: #1a1a1c; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px; overflow: hidden; }
        .match-header { background: #222; font-size: 10px; padding: 5px; text-align: center; color: var(--accent); font-weight: bold; }
        .match-row { padding: 10px 15px; display: flex; justify-content: space-between; font-size: 14px; border-bottom: 0.5px solid #222; }
        input, select { width: 100%; padding: 14px; margin-bottom: 10px; background: #222; border: 1px solid #444; border-radius: 12px; color: #fff; box-sizing: border-box; }
        .btn-main { background: var(--accent); color: #000; border: none; padding: 18px; border-radius: 15px; width: 100%; font-weight: 800; cursor: pointer; transition: 0.3s; }
        audio { width: 100%; height: 35px; filter: invert(1); margin-top: 10px; }
        
        /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è –∞–¥–º—ñ–Ω–∫–∏ */
        .admin-score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .score-box { background: #111; padding: 5px; border-radius: 8px; border: 1px solid #333; }
        .score-box label { font-size: 9px; color: var(--accent); display: block; }
    </style>
</head>
<body>

    <nav class="nav">
        <div class="nav-item active" onclick="showTab('tab-home', this)">üè† –ì–û–õ–û–í–ù–ê</div>
        <div class="nav-item" onclick="showTab('tab-bracket', this)">üìä –°–Ü–¢–ö–ê</div>
        <div class="nav-item" onclick="showTab('tab-player', this)">üéß –ü–õ–ï–Ñ–†</div>
        <div class="nav-item" onclick="showTab('tab-results', this)">üèÜ –†–ï–ô–¢–ò–ù–ì</div>
        <div class="nav-item" onclick="showTab('tab-judges', this)">üë®‚Äç‚öñÔ∏è –°–£–î–î–Ü</div>
        <div class="nav-item" onclick="showTab('tab-reg', this)">üé§ –£–ß–ê–°–¢–¨</div>
        <div class="nav-item" onclick="showTab('tab-admin', this)">üõ°Ô∏è –ê–î–ú–Ü–ù</div>
    </nav>

    <div id="tab-home" class="tab-content active">
        <div class="card">
            <div class="prize-badge">–ü–†–ò–ó: 50 000 –ì–†–ù</div>
            <h2>9VAL BATTLE: SEASON 1</h2>
            <p>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –Ω–∞ –Ω–∞–π–±—ñ–ª—å—à–∏–π –æ–Ω–ª–∞–π–Ω-–±–∞—Ç–ª –∫—Ä–∞—ó–Ω–∏.</p>
            <h3>–ü–†–ê–í–ò–õ–ê:</h3>
            <ul class="rules-list">
                <li>–¢—Ä–µ–∫ –¥–æ 2-—Ö —Ö–≤–∏–ª–∏–Ω.</li>
                <li>–¢–µ–º–∞: "–í—ñ–ª—å–Ω–∞".</li>
                <li>–°—É–¥–¥—ñ –æ—Ü—ñ–Ω—é—é—Ç—å: –¢–µ–∫—Å—Ç, –§–ª–æ—É, –ü–æ–¥–∞—á—É, –í–∞–π–±.</li>
            </ul>
        </div>
    </div>

    <div id="tab-bracket" class="tab-content">
        <h2>–¢—É—Ä–Ω—ñ—Ä–Ω–∞ –°—ñ—Ç–∫–∞</h2>
        <div class="match"><div class="match-header">1/8 –§–Ü–ù–ê–õ–£ #1</div><div class="match-row"><span>TBD</span><b>0</b></div></div>
    </div>

    <div id="tab-player" class="tab-content">
        <h2>–¢—Ä–µ–∫–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤</h2>
        <div id="player-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>

    <div id="tab-results" class="tab-content">
        <h2>–†–µ–π—Ç–∏–Ω–≥ –±–∞–ª—ñ–≤</h2>
        <div id="ranking-list"></div>
    </div>

    <div id="tab-judges" class="tab-content">
        <h2>–ù–∞—à—ñ –°—É–¥–¥—ñ</h2>
        <div class="card">MC Solomon & Flow</div>
    </div>

    <div id="tab-reg" class="tab-content">
        <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
        <div class="card">
            <form id="reg-form">
                <input type="text" id="r-name" placeholder="–¢–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º" required>
                <input type="text" id="r-city" placeholder="–ú—ñ—Å—Ç–æ" required>
                <input type="file" id="r-file" accept="audio/*" required>
                <button type="submit" id="r-btn" class="btn-main">–í–Ü–î–ü–†–ê–í–ò–¢–ò</button>
            </form>
        </div>
    </div>

    <div id="tab-admin" class="tab-content">
        <div id="admin-login">
            <input type="text" id="adm-u" placeholder="–õ–æ–≥—ñ–Ω">
            <input type="password" id="adm-p" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="login()">–£–í–Ü–ô–¢–ò</button>
        </div>
        <div id="admin-work" style="display:none;">
            <h2 id="hello-j">–ü–∞–Ω–µ–ª—å —Å—É–¥–¥—ñ</h2>
            <div id="admin-list"></div>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbwLlgAFARTIJX3CPPH4eRevaqUDO9gErXoI5PiapR3i2xEJLRFyuRfApYANdVsSHAJ4/exec";
        let user = null;

        function showTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            if(el) el.classList.add('active');
            load();
        }

        async function load() {
            try {
                const r = await fetch(API + "?action=getData");
                const d = await r.json();
                const all = d.allUsers || d.users || [];
                const u = all.slice(1);
                const ok = u.filter(i => i[4] === '–ü—Ä–∏–π–Ω—è—Ç–æ');

                // –ü–ª–µ—î—Ä –∑–∞–≥–∞–ª—å–Ω–∏–π
                document.getElementById('player-list').innerHTML = ok.map(i => `
                    <div class="card"><b>${i[1]}</b><audio controls src="${i[3]}"></audio></div>
                `).join('');

                // –†–µ–π—Ç–∏–Ω–≥
                document.getElementById('ranking-list').innerHTML = ok.map(i => {
                    const s = (((Number(i[5])||0)+(Number(i[6])||0)+(Number(i[7])||0)+(Number(i[8])||0))/4).toFixed(1);
                    return `<div class="card" style="display:flex; justify-content:space-between;"><span>${i[1]}</span><b>${s}</b></div>`;
                }).join('');

                // –ê–î–ú–Ü–ù–ö–ê (–û—Å—å —Ç—É—Ç –∑–º—ñ–Ω–∏, —è–∫—ñ —Ç–∏ –ø—Ä–æ—Å–∏–≤)
                if(user && document.getElementById('admin-list')) {
                    document.getElementById('admin-list').innerHTML = u.map((item, idx) => {
                        // –†–æ–±–∏–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø—Ä—è–º–∏–º –¥–ª—è –ø–ª–µ—î—Ä–∞
                        const streamUrl = item[3] ? item[3].replace("open?id=", "uc?export=download&id=") : "";
                        return `
                        <div class="card">
                            <b>${item[1]}</b> [${item[4]}]
                            <audio controls src="${streamUrl}"></audio>
                            <div class="admin-score-grid">
                                <div class="score-box"><label>–¢–µ–∫—Å—Ç</label><input type="number" id="t1-${idx}" value="${item[5]||0}"></div>
                                <div class="score-box"><label>–§–ª–æ—É</label><input type="number" id="t2-${idx}" value="${item[6]||0}"></div>
                                <div class="score-box"><label>–ü–æ–¥–∞—á–∞</label><input type="number" id="t3-${idx}" value="${item[7]||0}"></div>
                                <div class="score-box"><label>–í–∞–π–±</label><input type="number" id="t4-${idx}" value="${item[8]||0}"></div>
                            </div>
                            <button class="btn-main" style="padding:10px; margin-top:10px;" onclick="vote(${idx+2}, ${idx})">–ó–ë–ï–†–ï–ì–¢–ò</button>
                        </div>`;
                    }).join('');
                }
            } catch(e) { console.log(e); }
        }

        async function login() {
            const res = await fetch(API + "?action=getData");
            const d = await res.json();
            const j = d.judges.find(i => i[0] == document.getElementById('adm-u').value && i[1] == document.getElementById('adm-p').value);
            if(j) {
                user = j[2];
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-work').style.display = 'block';
                load();
            } else alert("–ü–æ–º–∏–ª–∫–∞!");
        }

        async function vote(row, i) {
            const p = {
                action: "vote", row: row,
                text: document.getElementById(`t1-${i}`).value,
                flow: document.getElementById(`t2-${i}`).value,
                podacha: document.getElementById(`t3-${i}`).value,
                vibe: document.getElementById(`t4-${i}`).value
            };
            await fetch(API, { method: 'POST', body: JSON.stringify(p) });
            alert("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!"); load();
        }

        window.onload = load;
    </script>
</body>
</html>
