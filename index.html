<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>9VAl BATTLE | PRO SYSTEM</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
    --accent: #ff9f0a;
    --bg: #000;
    --card: #1c1c1e;
    --text: #fff;
    --dim: #8e8e93;
    --green: #34c759;
    --border: #2c2c2e;
    --insta: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
}

* { box-sizing: border-box; outline: none; }
body { margin:0; font-family:-apple-system,sans-serif; background:var(--bg); color:var(--text); padding-bottom:120px; }

.page { display:none; padding:20px; animation:fadeIn 0.3s ease; }
.page.active { display:block; }
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

.glass-card { background:var(--card); border-radius:20px; padding:20px; margin-bottom:15px; border:1px solid var(--border); backdrop-filter: blur(6px); }

input, textarea, select { width:100%; padding:14px; margin:10px 0; background:#262629; border:1px solid #3a3a3c; border-radius:14px; color:#fff; font-size:16px; }

.btn { background:var(--accent); color:#000; border:none; padding:16px; border-radius:16px; width:100%; font-weight:800; cursor:pointer; transition:0.2s; }
.btn:hover { opacity:0.85; }
.btn:disabled { background:#333; color:#666; cursor:not-allowed; }

.tab-bar { position:fixed; bottom:0; left:0; right:0; display:flex; background:rgba(10,10,10,0.95); padding:12px 5px 35px; border-top:0.5px solid var(--border); }
.tab-item { flex:1; font-size:9px; font-weight:700; text-transform:uppercase; text-align:center; color:var(--dim); cursor:pointer; }
.tab-item.active { color:var(--accent); }
.tab-icon { font-size:22px; display:block; margin-bottom:4px; }

.rank-item { display:flex; justify-content:space-between; align-items:center; padding:15px; border-bottom:1px solid #222; }
.rank-val { color:var(--accent); font-weight:900; font-size:20px; }

.v-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:15px 0; }
.v-box { background:#000; padding:10px; border-radius:12px; border:1px solid #333; text-align:center; }
.v-box label { font-size:9px; color:var(--dim); display:block; margin-bottom:4px; }
.v-box input { background:none; border:none; font-size:22px; font-weight:900; color:var(--accent); text-align:center; width:100%; }

.judge-row { display:flex; align-items:center; padding:15px 0; border-bottom:1px solid var(--border); }
.judge-img { width:55px; height:55px; border-radius:50%; border:2px solid var(--accent); margin-right:15px; background:#333; }
.insta-btn { width:40px; height:40px; background:var(--insta); border-radius:12px; display:flex; align-items:center; justify-content:center; margin-left:auto; text-decoration:none; font-size:18px; color:white; }

audio { width:100%; height:35px; filter:invert(1); margin-top:10px; }
</style>
</head>
<body>

<!-- –ì–û–õ–û–í–ù–ê + –í–•–Ü–î –ê–î–ú–Ü–ù–ê -->
<div id="p-home" class="page active">
    <h1 id="battle-title">9VAl BATTLE</h1>
    <div class="glass-card" style="border-left:4px solid var(--accent)">
        <h3>–ü–†–ê–í–ò–õ–ê –ë–ê–¢–õ–£</h3>
        <ul id="rules-list" style="padding-left:18px; font-size:13px; color:#ddd">
            <li>1 –∞–≤—Ç–æ—Ä—Å—å–∫–∏–π —Ç—Ä–µ–∫ MP3</li>
            <li>–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ AI-–≤–æ–∫–∞–ª —Ç–∞ –ø–ª–∞–≥—ñ–∞—Ç</li>
            <li>–û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è: –¢–µ–∫—Å—Ç / –§–ª–æ—É / –ü–æ–¥–∞—á–∞ / –í–∞–π–±</li>
        </ul>
        <b id="battle-prize" style="color:var(--accent)">–ü–†–ò–ó: 50 000 –ì–†–ù</b>
    </div>
    <div class="glass-card" style="border-left:4px solid var(--green)">
        <b>–°–¢–ê–¢–£–°:</b> –ü–†–ò–ô–û–ú –¢–†–ï–ö–Ü–í –í–Ü–î–ö–†–ò–¢–û
    </div>

    <!-- –í–•–Ü–î –°–£–î–î–Ü -->
    <div class="glass-card" id="admin-login">
        <h3>–í–•–Ü–î –°–£–î–î–Ü</h3>
        <input type="text" id="a-login" placeholder="–õ–æ–≥—ñ–Ω">
        <input type="password" id="a-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" onclick="app.login()">–£–≤—ñ–π—Ç–∏</button>
    </div>

    <div class="glass-card" id="adm-panel" style="display:none;">
        <h3 id="judge-display" style="color:var(--accent)"></h3>
        <label>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–∏–∑</label><input type="text" id="e-p">
        <label>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞</label><textarea id="e-r"></textarea>
        <button class="btn" onclick="app.saveCMS()">–û–Ω–æ–≤–∏—Ç–∏ CMS</button>
    </div>
</div>

<!-- –ü–õ–ï–Ñ–† -->
<div id="p-player" class="page">
    <h2>–¢–†–ï–ö–ò</h2>
    <div class="glass-card" id="tracks-list"></div>
</div>

<!-- –¢–£–†–ù–Ü–†–ù–ê –¢–ê–ë–õ–ò–¶–Ø -->
<div id="p-stats" class="page">
    <h2>–†–ï–ô–¢–ò–ù–ì</h2>
    <div class="glass-card" style="padding:0" id="rank-list"></div>
</div>

<!-- –£–ß–ê–°–¢–¨ -->
<div id="p-reg" class="page">
    <h2>–£–ß–ê–°–¢–¨</h2>
    <div class="glass-card">
        <input type="text" id="r-nick" placeholder="–¢–≤—ñ–π –ù—ñ–∫">
        <input type="text" id="r-city" placeholder="–ú—ñ—Å—Ç–æ">
        <input type="file" id="r-file" accept="audio/*">
        <div style="display:flex; gap:12px; margin:20px 0; align-items:center;">
            <input type="checkbox" id="r-check" style="width:24px; height:24px;" onchange="document.getElementById('r-btn').disabled=!this.checked">
            <label style="font-size:11px; color:var(--dim)">–ó–≥–æ–¥–µ–Ω –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ 9VAl BATTLE</label>
        </div>
        <button class="btn" id="r-btn" disabled onclick="app.submitTrack()">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    </div>
</div>

<!-- –°–£–î–î–Ü -->
<div id="p-judges" class="page">
    <h2>–ñ–£–†–Ü</h2>
    <div class="glass-card" id="judges-list"></div>
</div>

<!-- TAB BAR -->
<nav class="tab-bar">
    <div class="tab-item active" onclick="app.nav('home', this)"><span class="tab-icon">üè†</span>–ì–û–õ–û–í–ù–ê</div>
    <div class="tab-item" onclick="app.nav('player', this)"><span class="tab-icon">üéß</span>–ü–õ–ï–Ñ–†</div>
    <div class="tab-item" onclick="app.nav('stats', this)"><span class="tab-icon">üìä</span>–¢–ê–ë–õ–ò–¶–Ø</div>
    <div class="tab-item" onclick="app.nav('reg', this)"><span class="tab-icon">üé§</span>–£–ß–ê–°–¢–¨</div>
    <div class="tab-item" onclick="app.nav('judges', this)"><span class="tab-icon">‚öñÔ∏è</span>–°–£–î–î–Ü</div>
</nav>

<script>
const judges = [
    {id:1,name:"TONY MUS1CZ",pass:"1",insta:"https://instagram.com/t0ny_mus1cz_prod/"},
    {id:2,name:"NeedForRap",pass:"1",insta:"https://instagram.com/aleksandr_kozlovvvvv/"},
    {id:3,name:"Nano",pass:"1",insta:"https://instagram.com/nano9val/"},
    {id:4,name:"KAZHAN",pass:"1",insta:"https://instagram.com/ka.zhan_/"}
];

let participantScores = {};
let participantTracks = [];

const app = {
    currentJudge: null,

    nav(id, el) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active'));
        document.getElementById('p-'+id).classList.add('active');
        el.classList.add('active');
    },

    login() {
        const l = document.getElementById('a-login').value;
        const p = document.getElementById('a-pass').value;
        const j = judges.find(i=>i.name===l && i.pass===p);
        if(j){
            this.currentJudge=j;
            document.getElementById('admin-login').style.display='none';
            document.getElementById('adm-panel').style.display='block';
            document.getElementById('judge-display').innerText="–°–£–î–î–Ø: "+j.name;
            document.getElementById('e-p').value=document.getElementById('battle-prize').innerText;
            document.getElementById('e-r').value=document.getElementById('rules-list').innerText;
        } else alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É");
    },

    saveCMS() {
        document.getElementById('battle-prize').innerText=document.getElementById('e-p').value;
        document.getElementById('rules-list').innerText=document.getElementById('e-r').value;
        alert("CMS –æ–Ω–æ–≤–ª–µ–Ω–æ!");
    },

    submitTrack() {
        const nick = document.getElementById('r-nick').value.trim();
        const city = document.getElementById('r-city').value.trim();
        const fileInput = document.getElementById('r-file');
        if(!nick || !city || !fileInput.files.length){ alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!"); return; }

        const track = {
            nick, city, file: URL.createObjectURL(fileInput.files[0]), approved:false
        };
        participantTracks.push(track);
        participantScores[nick]={judges:{},final:null};
        alert("–¢—Ä–µ–∫ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—é!");
        fileInput.value=""; document.getElementById('r-nick').value=""; document.getElementById('r-city').value="";
        document.getElementById('r-check').checked=false; document.getElementById('r-btn').disabled=true;
    },

    approveTrack(nick){
        const track = participantTracks.find(t=>t.nick===nick);
        if(track) { track.approved=true; this.renderTracks(); this.renderRank(); }
    },

    renderTracks(){
        const container=document.getElementById('tracks-list');
        container.innerHTML='';
        participantTracks.filter(t=>t.approved).forEach(t=>{
            container.innerHTML+=`<div class="glass-card"><div style="display:flex; justify-content:space-between"><b>${t.nick}</b><b>${t.final? t.final.toFixed(2):"0.00"}</b></div><audio controls src="${t.file}"></audio></div>`;
        });
    },

    renderRank(){
        const container=document.getElementById('rank-list');
        container.innerHTML='';
        const ranked = Object.entries(participantScores).map(([nick,data])=>{
            return {nick,final:data.final||0};
        }).sort((a,b)=>b.final-a.final);
        ranked.forEach((r,i)=>{
            container.innerHTML+=`<div class="rank-item"><span>${i+1}. ${r.nick}</span><span class="rank-val">${r.final.toFixed(2)}</span></div>`;
        });
    },

    saveScore(nick,scores){
        if(!this.currentJudge) return;
        const judgeName=this.currentJudge.name;
        if(participantScores[nick].judges[judgeName]){ alert("–í–∏ –≤–∂–µ –æ—Ü—ñ–Ω–∏–ª–∏!"); return; }
        const avg=(scores.reduce((a,b)=>a+b,0))/scores.length;
        participantScores[nick].judges[judgeName]=avg;
        participantScores[nick].final=Object.values(participantScores[nick].judges).reduce((a,b)=>a+b,0)/Object.values(participantScores[nick].judges).length;
        alert(`–°—É–¥–¥—è ${judgeName} –ø–æ—Å—Ç–∞–≤–∏–≤: ${avg.toFixed(1)}`);
        this.renderTracks(); this.renderRank();
    }
};

window.onload = ()=>{
    const judgesContainer=document.getElementById('judges-list');
    judges.forEach(j=>{
        judgesContainer.innerHTML+=`
        <div class="judge-row"><div class="judge-img"></div>
        <div><b>${j.name}</b><br><small>–°—É–¥–¥—è</small></div>
        <a href="${j.insta}" target="_blank" class="insta-btn">üì∏</a></div>`;
    });
    window.Telegram?.WebApp.expand();
};
</script>
</body>
</html>
