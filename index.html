<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>9VAl BATTLE | PRO SYSTEM</title>
<style>
:root {
    --accent:#ff9f0a; --bg:#000; --card:#1c1c1e; --text:#fff; --dim:#8e8e93; --border:#2c2c2e;
}
body{margin:0;padding-bottom:120px;font-family:-apple-system,sans-serif;color:var(--text);background:var(--bg);}
.tab-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(10,10,10,0.95);display:flex;padding:12px 5px 35px;border-top:0.5px solid var(--border);}
.tab-item{flex:1;text-align:center;font-size:10px;color:var(--dim);cursor:pointer;font-weight:700;text-transform:uppercase;}
.tab-item.active{color:var(--accent);}
.page{display:none;padding:20px;}
.page.active{display:block;}
.glass-card{background:var(--card);border-radius:20px;padding:20px;margin-bottom:15px;border:1px solid var(--border);}
.v-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:15px 0;}
.v-box{background:#000;padding:10px;border-radius:12px;border:1px solid #333;text-align:center;}
.v-box label{font-size:9px;color:var(--dim);display:block;margin-bottom:4px;}
.v-box input{background:none;border:none;font-size:20px;font-weight:900;color:var(--accent);text-align:center;width:100%;}
.btn{background:var(--accent);color:#000;border:none;padding:16px;border-radius:16px;width:100%;font-weight:800;cursor:pointer;}
.rank-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #222;}
.rank-val{color:var(--accent);font-weight:900;}
</style>
</head>
<body>

<!-- –ì–æ–ª–æ–≤–Ω–∞ -->
<div id="p-home" class="page active">
    <h1>9VAl BATTLE</h1>
    <div class="glass-card" style="border-left:4px solid var(--accent)">
        <h3>–ü–†–ê–í–ò–õ–ê –ë–ê–¢–õ–£</h3>
        <ul style="padding-left:18px;font-size:13px;color:#ddd">
            <li>1 –∞–≤—Ç–æ—Ä—Å—å–∫–∏–π —Ç—Ä–µ–∫ MP3</li>
            <li>–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ AI-–≤–æ–∫–∞–ª —Ç–∞ –ø–ª–∞–≥—ñ–∞—Ç</li>
            <li>–û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è: –¢–µ–∫—Å—Ç / –§–ª–æ—É / –ü–æ–¥–∞—á–∞ / –í–∞–π–±</li>
        </ul>
        <p>–ü—Ä–∏–∑: <span id="cms-prize">5000‚Ç¥</span></p>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü—è -->
<div id="p-stats" class="page">
    <h2>–†–ï–ô–¢–ò–ù–ì</h2>
    <div id="rank-list"></div>
</div>

<!-- –£—á–∞—Å—Ç—å -->
<div id="p-participate" class="page">
    <h2>–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</h2>
    <div class="glass-card">
        <input type="text" id="p-nick" placeholder="–ù—ñ–∫">
        <input type="text" id="p-city" placeholder="–ú—ñ—Å—Ç–æ">
        <input type="file" id="p-file" accept=".mp3">
        <label style="font-size:12px"><input type="checkbox" id="p-agree"> –ü–æ–≥–æ–¥–∂—É—é—Å—å –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏</label>
        <button class="btn" onclick="app.submitParticipant()">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    </div>
</div>

<!-- –ê–¥–º—ñ–Ω–∫–∞ -->
<div id="p-admin" class="page">
    <h2>–ê–¥–º—ñ–Ω–∫–∞</h2>
    <div id="adm-auth">
        <input type="text" id="a-login" placeholder="–õ–æ–≥—ñ–Ω —Å—É–¥–¥—ñ">
        <input type="password" id="a-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" onclick="app.login()">–£–≤—ñ–π—Ç–∏</button>
    </div>

    <div id="adm-panel" style="display:none">
        <h3 id="judge-display" style="color:var(--accent)"></h3>
        <h4>–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è CMS</h4>
        <label>–ü—Ä–∏–∑</label><input type="text" id="e-p">
        <label>–ü—Ä–∞–≤–∏–ª–∞</label><textarea id="e-r"></textarea>
        <button class="btn" onclick="app.saveCMS()">–û–Ω–æ–≤–∏—Ç–∏ CMS</button>
        <hr>
        <h4>–û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫—ñ–≤</h4>
        <div id="judge-tracks-list"></div>
    </div>
</div>

<!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
<nav class="tab-bar">
    <div class="tab-item active" onclick="app.nav('home', this)">üè†<br>–ì–æ–ª–æ–≤–Ω–∞</div>
    <div class="tab-item" onclick="app.nav('stats', this)">üìä<br>–¢–∞–±–ª–∏—Ü—è</div>
    <div class="tab-item" onclick="app.nav('participate', this)">üé§<br>–£—á–∞—Å—Ç—å</div>
    <div class="tab-item" onclick="app.nav('admin', this)">üõ°Ô∏è<br>–ê–¥–º—ñ–Ω</div>
</nav>

<script>
const judges = [
    {name:"TONY MUS1CZ",pass:"1"},
    {name:"NeedForRap",pass:"1"},
    {name:"Nano",pass:"1"},
    {name:"KAZHAN",pass:"1"}
];

const participantTracks = [];
const participantScores = {};

// –ì–µ–Ω–µ—Ä—É—î–º–æ 50 —É—á–∞—Å–Ω–∏–∫—ñ–≤
for(let i=1;i<=50;i++){
    const nick = `MC_${i}`;
    participantTracks.push({nick:nick,file:`tracks/${nick}.mp3`,approved:false});
    participantScores[nick] = {judges:{},final:0};
}

const app = {
    currentJudge:null,

    nav(id,el){
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active'));
        document.getElementById('p-'+id).classList.add('active');
        el.classList.add('active');
    },

    login(){
        const l = document.getElementById('a-login').value;
        const p = document.getElementById('a-pass').value;
        const j = judges.find(j=>j.name===l && j.pass===p);
        if(j){
            this.currentJudge=j;
            document.getElementById('adm-auth').style.display='none';
            document.getElementById('adm-panel').style.display='block';
            document.getElementById('judge-display').innerText="–°—É–¥–¥—è: "+j.name;
            this.renderJudgeTracks();
        } else alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É");
    },

    submitParticipant(){
        const nick=document.getElementById('p-nick').value.trim();
        const city=document.getElementById('p-city').value.trim();
        const file=document.getElementById('p-file').files[0];
        const agree=document.getElementById('p-agree').checked;
        if(!nick||!city||!file||!agree) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è —Ç–∞ –ø–æ–≥–æ–¥—å—Ç–µ—Å—å –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏");
        participantTracks.push({nick:nick,file:URL.createObjectURL(file),approved:false});
        participantScores[nick]={judges:{},final:0};
        alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—é –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞!");
    },

    renderJudgeTracks(){
        const container=document.getElementById('judge-tracks-list');
        container.innerHTML='';
        participantTracks.filter(t=>t.approved).forEach(t=>{
            const scores=participantScores[t.nick].judges[this.currentJudge?.name]||[0,0,0,0];
            container.innerHTML+=`
            <div class="glass-card" style="margin-bottom:15px;">
                <b>${t.nick}</b> - <audio controls src="${t.file}"></audio>
                <div class="v-grid" style="margin-top:10px;">
                    <div class="v-box"><label>–¢–µ–∫—Å—Ç</label><input type="number" min="1" max="10" value="${scores[0]}" id="s-${t.nick}-1"></div>
                    <div class="v-box"><label>–§–ª–æ—É</label><input type="number" min="1" max="10" value="${scores[1]}" id="s-${t.nick}-2"></div>
                    <div class="v-box"><label>–ü–æ–¥–∞—á–∞</label><input type="number" min="1" max="10" value="${scores[2]}" id="s-${t.nick}-3"></div>
                    <div class="v-box"><label>–í–∞–π–±</label><input type="number" min="1" max="10" value="${scores[3]}" id="s-${t.nick}-4"></div>
                </div>
                <button class="btn" style="margin-top:10px;" onclick="app.saveJudgeScore('${t.nick}')">–ó–±–µ—Ä–µ–≥—Ç–∏ –æ—Ü—ñ–Ω–∫—É</button>
            </div>`;
        });
    },

    saveJudgeScore(nick){
        if(!this.currentJudge) return alert("–£–≤—ñ–π–¥—ñ—Ç—å —è–∫ —Å—É–¥–¥—è");
        const scores=[];
        for(let i=1;i<=4;i++){
            const val=Number(document.getElementById(`s-${nick}-${i}`).value);
            if(isNaN(val)||val<1||val>10) return alert("–û—Ü—ñ–Ω–∫–∏ –≤—ñ–¥ 1 –¥–æ 10!");
            scores.push(val);
        }
        const judgeName=this.currentJudge.name;
        if(participantScores[nick].judges[judgeName]) return alert("–í–∏ –≤–∂–µ –æ—Ü—ñ–Ω–∏–ª–∏ —Ü—å–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞!");
        const avg=scores.reduce((a,b)=>a+b,0)/scores.length;
        participantScores[nick].judges[judgeName]=avg;
        const allScores=Object.values(participantScores[nick].judges);
        participantScores[nick].final=allScores.reduce((a,b)=>a+b,0)/allScores.length;
        alert(`–°—É–¥–¥—è ${judgeName} –ø–æ—Å—Ç–∞–≤–∏–≤: ${avg.toFixed(1)}`);
        this.renderJudgeTracks();
        this.renderRank();
    },

    renderRank(){
        const container=document.getElementById('rank-list');
        container.innerHTML='';
        participantTracks.filter(t=>t.approved).sort((a,b)=>participantScores[b.nick].final-participantScores[a.nick].final)
        .forEach((t,i)=>{
            container.innerHTML+=`
            <div class="rank-item">
                <span>${i+1}. ${t.nick}</span>
                <span class="rank-val">${participantScores[t.nick].final.toFixed(2)}</span>
            </div>`;
        });
    },

    saveCMS(){
        const prize=document.getElementById('e-p').value;
        const rules=document.getElementById('e-r').value;
        document.getElementById('cms-prize').innerText=prize||"5000‚Ç¥";
        alert("CMS –æ–Ω–æ–≤–ª–µ–Ω–æ!");
    }
};
</script>

</body>
</html>
