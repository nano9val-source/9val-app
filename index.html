<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBWYGmKh1PVswbmymOo9urGl-g6Dtnu4pA",
            authDomain: "valbattl.firebaseapp.com",
            projectId: "valbattl",
            storageBucket: "valbattl.firebasestorage.app",
            messagingSenderId: "397888194127",
            appId: "1:397888194127:web:73cd74e34aa3615a398c3a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        window.submitReg = async () => {
            const user = tg.initDataUnsafe.user;
            const city = document.getElementById('city').value;
            const social = document.getElementById('social').value;

            if (!city || !social) {
                alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!");
                return;
            }

            if (user) {
                await setDoc(doc(db, "users", user.id.toString()), {
                    name: user.first_name,
                    username: user.username || "no_nick",
                    city: city,
                    social: social,
                    status: "on_selection", // –°—Ç–∞—Ç—É—Å: –Ω–∞ –æ—Ç–±–æ—Ä–µ
                    regDate: new Date().toISOString()
                }, { merge: true });
                
                document.getElementById('regForm').innerHTML = "<h3>‚úÖ –ó–∞—è–≤–∫–∞ –ø–æ–¥–∞–Ω–∞!</h3><p>–û—á—ñ–∫—É–π—Ç–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—ñ–¥–±–æ—Ä—É.</p>";
            }
        };
    </script>
    <style>
        body { background: #000; color: #00f0ff; font-family: 'Arial', sans-serif; padding: 15px; text-align: center; }
        .header { border: 2px solid #ff0055; border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 0 10px #ff0055; }
        .prize { color: #fff; font-size: 1.5em; font-weight: bold; margin: 10px 0; }
        .card { background: #111; border: 1px solid #333; padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: left; }
        input { width: 90%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #00f0ff; color: #fff; border-radius: 5px; }
        .btn { background: #00f0ff; color: #000; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .rules { font-size: 0.9em; color: #ccc; line-height: 1.4; }
        b { color: #ff0055; }
    </style>
</head>
<body>

<div class="header">
    <h1>9VAL BATTLE</h1>
    <div class="prize">–ü–†–ò–ó–û–í–ò–ô –§–û–ù–î: 50 000 –ì–†–ù</div>
</div>

<div class="card" id="regForm">
    <h3>üìù –†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø (–í–Ü–î–ë–Ü–†)</h3>
    <p class="rules">–¢—ñ–ª—å–∫–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç—ñ–≤ –∑ <b>–£–∫—Ä–∞—ó–Ω–∏</b>. –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç ‚Äî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞.</p>
    <input type="text" id="city" placeholder="–í–∞—à–µ –º—ñ—Å—Ç–æ –≤ –£–∫—Ä–∞—ó–Ω—ñ">
    <input type="text" id="social" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Instagram / SoundCloud">
    <button class="btn" onclick="submitReg()">–ü–û–î–ê–¢–ò –ó–ê–Ø–í–ö–£ –ù–ê –í–Ü–î–ë–Ü–†</button>
</div>

<div class="card">
    <h3>üìã –ü–†–ê–í–ò–õ–ê –¢–ê –£–ú–û–í–ò</h3>
    <ul class="rules">
        <li>–ë—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å –º–æ–∂—É—Ç—å –ª–∏—à–µ –∂–∏—Ç–µ–ª—ñ <b>–£–∫—Ä–∞—ó–Ω–∏</b>.</li>
        <li>–ú–æ–≤–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: –ø–µ—Ä–µ–≤–∞–∂–Ω–æ <b>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</b> (RU –¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è).</li>
        <li>–í—ñ–¥–±—ñ—Ä –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∞—à–∏—Ö –¥–µ–º–æ-–∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ —Å–æ—Ü–º–µ—Ä–µ–∂.</li>
        <li><b>1 –º—ñ—Å—Ü–µ ‚Äî 50 000 –≥—Ä–Ω.</b></li>
    </ul>
</div>

</body>
</html>
